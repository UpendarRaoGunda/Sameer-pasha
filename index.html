<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Raghava Consultency — Ad Generator (Fixed Layout)</title>

  <!-- Fonts -->
  <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+Telugu:wght@400;700&family=Poppins:wght@300;500;700;900&display=swap" rel="stylesheet">

  <style>
    :root{
      --w:1080; --h:1920;
      --gold:#f5b041;
    }
    *{box-sizing:border-box}
    body{
      margin:0;
      min-height:100vh;
      font-family: "Poppins", system-ui, -apple-system, "Segoe UI", Roboto, Arial;
      background:
        radial-gradient(900px 450px at 10% 10%, rgba(11,95,138,0.10), transparent 6%),
        linear-gradient(180deg,#052238 0%, #07172a 100%);
      color:#e6eef7;
      display:flex;
      gap:20px;
      padding:28px;
      align-items:flex-start;
      justify-content:center;
    }

    .sidebar{
      width:380px;
      background: linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01));
      border-radius:12px;
      padding:16px;
      box-shadow:0 10px 30px rgba(2,10,20,0.6);
      border:1px solid rgba(255,255,255,0.03);
    }
    .sidebar h1{font-size:18px;margin:0 0 10px 0}
    label{display:block;font-size:13px;color:#bcd6eb;margin-top:10px}
    input[type="text"], textarea, select{width:100%; padding:10px 12px; margin-top:6px; border-radius:8px; border:1px solid rgba(255,255,255,0.06); background: rgba(255,255,255,0.02); color:var(--gold); outline:none; font-size:14px;}
    textarea{min-height:70px; resize:vertical}
    .row{display:flex; gap:8px}
    .small{flex:1}
    .btn{display:inline-block; width:100%; padding:12px; margin-top:12px; border-radius:10px; border:none; cursor:pointer; font-weight:700; font-size:14px; color:#061226; background: linear-gradient(90deg,var(--gold), #e4a13b); box-shadow: 0 8px 24px rgba(245,180,66,0.16);}
    .btn.secondary{background:linear-gradient(90deg,#2b9ed7,#2688c8); color:white; box-shadow:0 8px 24px rgba(34,120,180,0.12);}
    .controls{display:flex; gap:8px; margin-top:8px}
    .previewWrap{width:420px; display:flex; flex-direction:column; align-items:center; gap:10px}
    canvas{ width:360px; height:640px; border-radius:14px; box-shadow: 0 20px 60px rgba(3,12,28,0.6); background:white;}
    .templateList{display:flex; gap:8px; margin-top:8px}
    .templateItem{flex:1; padding:8px; text-align:center; border-radius:10px; cursor:pointer; font-weight:600; background:transparent; color:#cfe8ff; border:1px solid transparent}
    .templateItem.active{background:rgba(255,255,255,0.03); border:1px solid rgba(255,255,255,0.04)}
    .meta{color:#9ec6e3; font-size:13px; text-align:center}
  </style>
</head>
<body>

  <aside class="sidebar" aria-label="controls">
    <h1>Raghava Consultency — Ad Maker (fixed)</h1>

    <label>Template</label>
    <div class="templateList" role="tablist">
      <div class="templateItem active" data-template="classic">Classic</div>
      <div class="templateItem" data-template="modern">Modern</div>
      <div class="templateItem" data-template="luxe">Luxe</div>
    </div>

    <label>Telugu Headline</label>
    <input id="headlineTel" type="text" value="రాఘవ కన్సల్టెన్సీ — హోమ్ లోన్స్ & మార్ట్గేజ్ లోన్స్">

    <label>Telugu Subheading</label>
    <input id="subTel" type="text" value="మీ కలల ఇల్లు ఇప్పుడు మీ చేతుల్లోనే!">

    <label>Bullets (comma-separated)</label>
    <input id="bullets" type="text" value="₹5 లక్షల నుండి ₹1 కోటి వరకు లోన్, తక్కువ వడ్డీ రేట్లు & వేగవంతమైన మంజూరు, డోర్‌స్టెప్ డాక్యుమెంటేషన్">

    <div class="row">
      <div class="small">
        <label>Phone</label>
        <input id="phone" type="text" value="90148 33945">
      </div>
      <div class="small">
        <label>Website</label>
        <input id="site" type="text" value="www.raghavaconsultency.com">
      </div>
    </div>

    <label>Upload Photo (optional)</label>
    <input id="photoFile" type="file" accept="image/*">

    <label>Upload Logo (optional)</label>
    <input id="logoFile" type="file" accept="image/*">

    <div style="display:flex; gap:8px;">
      <button id="renderBtn" class="btn">Render</button>
      <button id="downloadBtn" class="btn secondary">Download PNG</button>
    </div>

    <div style="display:flex; gap:8px; margin-top:8px;">
      <button id="downloadPoster" class="btn" style="background:linear-gradient(90deg,#6f4bd7,#9b6cf2)">Download Poster (2000×3000)</button>
      <button id="downloadSet" class="btn" style="background:linear-gradient(90deg,#3dd6a5,#18b686)">Download All Sizes</button>
    </div>

    <div style="margin-top:8px; color:#9ec6e3; font-size:13px;">Tip: test with lengthy Telugu bullets to verify auto-adjustment.</div>
  </aside>

  <main class="previewWrap" aria-live="polite">
    <canvas id="adCanvas" width="1080" height="1920" role="img" aria-label="Ad preview"></canvas>
    <div class="meta">Preview (scaled). Click Render then Download. Templates: Classic / Modern / Luxe</div>
  </main>

<script>
/* Complete fixed ad generator:
   - Dynamic measurement to avoid overlapping bullets and portrait
   - Photo & logo upload
   - Multiple templates and downloads
*/

// DOM elements
const canvas = document.getElementById('adCanvas');
const ctx = canvas.getContext('2d', { alpha: false });
const renderBtn = document.getElementById('renderBtn');
const downloadBtn = document.getElementById('downloadBtn');
const downloadPoster = document.getElementById('downloadPoster');
const downloadSet = document.getElementById('downloadSet');

const headlineTelInput = document.getElementById('headlineTel');
const subTelInput = document.getElementById('subTel');
const bulletsInput = document.getElementById('bullets');
const phoneInput = document.getElementById('phone');
const siteInput = document.getElementById('site');
const photoFile = document.getElementById('photoFile');
const logoFile = document.getElementById('logoFile');
const templateItems = Array.from(document.querySelectorAll('.templateItem'));

let activeTemplate = 'classic';
templateItems.forEach(it => it.addEventListener('click', ()=> {
  templateItems.forEach(i=>i.classList.remove('active'));
  it.classList.add('active');
  activeTemplate = it.dataset.template;
}));

// uploaded images
let uploadedPhoto = null;
let uploadedLogo = null;
photoFile.addEventListener('change', e => {
  const f = e.target.files[0];
  if(!f) return;
  const url = URL.createObjectURL(f);
  loadImage(url).then(img => { uploadedPhoto = img; URL.revokeObjectURL(url); }).catch(()=>{ uploadedPhoto=null; });
});
logoFile.addEventListener('change', e => {
  const f = e.target.files[0];
  if(!f) return;
  const url = URL.createObjectURL(f);
  loadImage(url).then(img => { uploadedLogo = img; URL.revokeObjectURL(url); }).catch(()=>{ uploadedLogo=null; });
});

// helper: load HTMLImageElement
function loadImage(src){
  return new Promise((resolve,reject)=>{
    const img = new Image();
    img.crossOrigin = "anonymous";
    img.onload = ()=> resolve(img);
    img.onerror = reject;
    img.src = src;
  });
}

// rounding helper
function roundRectPath(ctx,x,y,w,h,r){
  ctx.beginPath();
  ctx.moveTo(x+r,y);
  ctx.arcTo(x+w,y,x+w,y+h,r);
  ctx.arcTo(x+w,y+h,x,y+h,r);
  ctx.arcTo(x,y+h,x,y,r);
  ctx.arcTo(x,y,x+w,y,r);
  ctx.closePath();
}

// simple house icon drawer
function drawHouseIcon(ctx,x,y,size,fill){
  ctx.save();
  ctx.translate(x,y);
  ctx.beginPath();
  ctx.moveTo(0,-size*0.35);
  ctx.lineTo(-size*0.45,0);
  ctx.lineTo(-size*0.45,size*0.35);
  ctx.lineTo(size*0.45,size*0.35);
  ctx.lineTo(size*0.45,0);
  ctx.closePath();
  ctx.fillStyle = fill;
  ctx.fill();
  ctx.restore();
}

// measure wrapped lines (returns array)
function measureWrappedLines(ctx, text, maxWidth){
  const words = text.split(' ');
  let line = '';
  const lines = [];
  for(let n=0;n<words.length;n++){
    const testLine = line + words[n] + ' ';
    const metrics = ctx.measureText(testLine);
    if(metrics.width > maxWidth && n > 0){
      lines.push(line.trim());
      line = words[n] + ' ';
    } else {
      line = testLine;
    }
  }
  if(line.trim().length) lines.push(line.trim());
  return lines;
}

// draw array of lines at x,y with lineHeight. align: 'left'|'center'
function drawWrappedText(ctx, lines, x, y, lineHeight, align='left'){
  ctx.textAlign = align;
  for(let i=0;i<lines.length;i++){
    ctx.fillText(lines[i], x, y + (i * lineHeight));
  }
  return lines.length * lineHeight;
}

// main draw function (dynamic)
async function draw(data, width=1080, height=1920){
  await document.fonts.ready;
  canvas.width = width;
  canvas.height = height;

  // background per template
  if(activeTemplate === 'classic'){
    const g = ctx.createLinearGradient(0,0,0,height);
    g.addColorStop(0,'#07243a'); g.addColorStop(0.45,'#06334f'); g.addColorStop(1,'#041226');
    ctx.fillStyle = g; ctx.fillRect(0,0,width,height);
  } else if(activeTemplate === 'modern'){
    const g = ctx.createLinearGradient(0,0,width,height);
    g.addColorStop(0,'#06293a'); g.addColorStop(1,'#0b4b6b');
    ctx.fillStyle = g; ctx.fillRect(0,0,width,height);
  } else {
    const g = ctx.createLinearGradient(0,0,0,height);
    g.addColorStop(0,'#081224'); g.addColorStop(0.6,'#0d2540'); g.addColorStop(1,'#0b1220');
    ctx.fillStyle = g; ctx.fillRect(0,0,width,height);
    const vign = ctx.createRadialGradient(width*0.5, height*0.36, 200, width*0.5, height*0.36, Math.max(width,height));
    vign.addColorStop(0,'rgba(245,180,66,0.08)'); vign.addColorStop(1,'rgba(0,0,0,0)');
    ctx.fillStyle = vign; ctx.fillRect(0,0,width,height);
  }

  // central warm glow
  const glow = ctx.createRadialGradient(width/2, height*0.36, 10, width/2, height*0.36, 900);
  glow.addColorStop(0,'rgba(245,180,66,0.95)');
  glow.addColorStop(0.15,'rgba(245,180,66,0.28)');
  glow.addColorStop(0.35,'rgba(0,0,0,0.02)');
  glow.addColorStop(1,'rgba(0,0,0,0)');
  ctx.fillStyle = glow; ctx.fillRect(0,0,width,height);

  // subtle skyline
  ctx.save();
  ctx.globalAlpha = 0.06; ctx.fillStyle = '#000';
  for(let i=0;i<12;i++){ const wRect = 80 + (i%4)*30; const hRect = 140 + (i%5)*60; const x = i * 90; const y = height*0.58 - hRect; ctx.fillRect(x,y,wRect,hRect); }
  ctx.restore();

  // house area
  const houseW = Math.round(width*0.5);
  const houseH = Math.round(height*0.21);
  const houseX = Math.round(width*0.06);
  const houseY = Math.round(height*0.48);
  roundRectPath(ctx, houseX, houseY, houseW, houseH, 24);
  ctx.fillStyle = 'rgba(255,255,255,0.04)'; ctx.fill();

  // windows
  ctx.fillStyle = '#ffdca2'; ctx.fillRect(houseX+60, houseY+40, 140, 90); ctx.fillRect(houseX+240, houseY+40, 120,90); ctx.fillRect(houseX+420, houseY+40, 80,90);
  // roof
  ctx.beginPath(); ctx.moveTo(houseX-20, houseY+10); ctx.lineTo(houseX+houseW/2, houseY-110); ctx.lineTo(houseX+houseW+20, houseY+10); ctx.closePath(); ctx.fillStyle='rgba(0,0,0,0.12)'; ctx.fill();
  ctx.strokeStyle='rgba(245,180,66,0.08)'; ctx.lineWidth=4; ctx.stroke();

  // draw logo or text top-left
  if(uploadedLogo){
    const lW = Math.round(width*0.18), lH = Math.round(width*0.06), lx = Math.round(width*0.06), ly = Math.round(height*0.06);
    roundRectPath(ctx, lx-8, ly-8, lW+16, lH+16, 12); ctx.fillStyle='rgba(0,0,0,0.16)'; ctx.fill();
    const img = uploadedLogo;
    const ratio = Math.min(lW/img.width, lH/img.height);
    const drawW = img.width * ratio; const drawH = img.height * ratio;
    const drawX = lx + (lW - drawW)/2; const drawY = ly + (lH - drawH)/2;
    ctx.drawImage(img, drawX, drawY, drawW, drawH);
  } else {
    ctx.font = '700 32px Poppins, sans-serif'; ctx.fillStyle = '#ffdca2'; ctx.textAlign = 'left'; ctx.fillText('RaghavaConsultency', width*0.06, height*0.09);
  }

  // headline (Telugu)
  ctx.font = `700 ${Math.round(width*0.055)}px "Noto Sans Telugu", Poppins, sans-serif`;
  ctx.fillStyle = '#fffaf0'; ctx.textAlign = 'center';
  wrapAndDraw(ctx, data.headlineTel, width/2, height*0.14, width - 120, Math.round(width*0.07));

  // subheading
  ctx.font = `600 ${Math.round(width*0.035)}px "Noto Sans Telugu", Poppins, sans-serif`;
  ctx.fillStyle = 'rgba(255,255,255,0.92)';
  wrapAndDraw(ctx, data.subTel, width/2, height*0.205, width - 160, Math.round(width*0.044));

  // BULLETS & PORTRAIT (DYNAMIC)
  // constants
  const bullets = data.bullets.split(',').map(s=>s.trim()).filter(Boolean).slice(0,8);
  const bulletsFontSize = Math.round(width*0.034);
  ctx.font = `500 ${bulletsFontSize}px "Noto Sans Telugu", Poppins, sans-serif`;
  const bulletsMaxWidth = Math.round(width * 0.36); // available width for bullet text
  const bulletsX = Math.round(width * 0.58);
  let bulletsY = Math.round(height * 0.52);
  const bulletLineHeight = Math.round(width * 0.048);

  // measure each bullet (lines & height)
  const measured = bullets.map(b => {
    const lines = measureWrappedLines(ctx, b, bulletsMaxWidth);
    return { text: b, lines, height: lines.length * bulletLineHeight };
  });

  // total bullets height with small spacing
  const bulletsTotalHeight = measured.reduce((acc,m)=> acc + m.height + Math.round(width*0.015), 0);

  // portrait candidate
  const portraitSize = Math.round(width*0.22);
  let portraitX = Math.round(width * 0.74);
  let portraitY = Math.round(height * 0.50);

  // compute vertical ranges
  const bulletsTop = bulletsY;
  const bulletsBottom = bulletsY + bulletsTotalHeight;
  const portraitTop = portraitY - portraitSize/2;
  const portraitBottom = portraitY + portraitSize/2;

  // if vertical overlap (and horizontal proximity) -> move portrait below bullets
  if (!( (bulletsBottom < portraitTop - 20) || (bulletsTop > portraitBottom + 20) )){
    portraitY = bulletsBottom + portraitSize/2 + Math.round(width*0.04);
  }

  // draw bullets now (icons + wrapped lines)
  ctx.fillStyle = 'rgba(255,255,255,0.96)';
  let currentY = bulletsY;
  measured.forEach((m, idx) => {
    // bullet circle
    ctx.beginPath();
    ctx.arc(bulletsX - 70, currentY + 6, 22, 0, Math.PI*2);
    ctx.fillStyle = '#ffdca2'; ctx.fill();
    // small house icon inside circle
    ctx.save(); ctx.fillStyle = '#0b2740'; drawHouseIcon(ctx, bulletsX - 77, currentY - 6, 26, '#0b2740'); ctx.restore();
    // draw wrapped lines
    ctx.fillStyle = '#fff';
    drawWrappedText(ctx, m.lines, bulletsX - 20, currentY + 6, bulletLineHeight, 'left');
    currentY += m.height + Math.round(width*0.015);
  });

  // Draw portrait (clipped) at portraitX, portraitY
  if(uploadedPhoto){
    const px = portraitX, py = portraitY, pSize = portraitSize;
    ctx.save();
    // soft shadow behind circle
    ctx.beginPath();
    ctx.arc(px, py - 20, pSize/2 + 8, 0, Math.PI*2);
    ctx.fillStyle = 'rgba(0,0,0,0.18)'; ctx.fill();
    // clip circle and draw photo as cover
    ctx.beginPath(); ctx.arc(px, py - 20, pSize/2, 0, Math.PI*2); ctx.closePath(); ctx.clip();
    const img = uploadedPhoto;
    let sx=0, sy=0, sw=img.width, sh=img.height;
    const ratio = img.width / img.height;
    if(ratio > 1){ sw = img.height; sx = Math.round((img.width - sw)/2); } else { sh = img.width; sy = Math.round((img.height - sh)/2); }
    ctx.drawImage(img, sx, sy, sw, sh, px - pSize/2, py - 20 - pSize/2, pSize, pSize);
    ctx.restore();
  } else {
    // placeholder
    const px = portraitX, py = portraitY, pSize = portraitSize;
    ctx.beginPath(); ctx.arc(px, py - 20, pSize/2, 0, Math.PI*2); ctx.fillStyle = 'rgba(255,255,255,0.06)'; ctx.fill();
    ctx.font = `700 ${Math.round(pSize*0.28)}px Poppins, sans-serif`; ctx.fillStyle = '#ffdca2'; ctx.textAlign='center'; ctx.textBaseline='middle';
    ctx.fillText('HP', px, py - 20);
  }

  // CONTACT BLOCK bottom center
  const cH = Math.round(height*0.14);
  const cW = Math.round(width*0.86);
  const cX = Math.round((width - cW)/2);
  const cY = Math.round(height*0.74);
  roundRectPath(ctx, cX, cY, cW, cH, 18); ctx.fillStyle = 'rgba(0,0,0,0.22)'; ctx.fill();

  ctx.font = `800 ${Math.round(width*0.055)}px Poppins, sans-serif`; ctx.fillStyle='#fff'; ctx.textAlign='center';
  ctx.fillText(data.phone, width/2, cY + (cH*0.45));

  ctx.font = `500 ${Math.round(width*0.032)}px Poppins, sans-serif`; ctx.fillStyle = 'rgba(255,255,255,0.84)';
  ctx.fillText(data.site, width/2, cY + (cH*0.75));

  // brand name
  ctx.font = `900 ${Math.round(width*0.05)}px Poppins, sans-serif`; ctx.fillStyle='#ffdca2'; ctx.fillText('RAGHAVA Consultency', width/2, height*0.925);

  // tagline
  ctx.font = `500 ${Math.round(width*0.03)}px Poppins, sans-serif`; ctx.fillStyle='rgba(255,255,255,0.9)'; ctx.fillText('Transforming Dreams into Homes.', width/2, height*0.96);

  // footer small
  ctx.font = `400 ${Math.round(width*0.02)}px Poppins, sans-serif`; ctx.fillStyle='rgba(255,255,255,0.12)'; ctx.fillText('Associated with major Banks & NBFCs', width/2, height*0.986);
}

// small helper: wrap and draw (used for headline/sub)
function wrapAndDraw(ctx, text, x, y, maxWidth, lineHeight){
  const font = ctx.font;
  const lines = measureWrappedLines(ctx, text, maxWidth);
  for(let i=0;i<lines.length;i++){
    ctx.fillText(lines[i], x, y + (i * lineHeight));
  }
  ctx.font = font;
}

// render driver
async function renderAd(width=1080, height=1920){
  const data = {
    headlineTel: headlineTelInput.value.trim() || 'రాఘవ కన్సల్టెన్సీ — హోమ్ లోన్స్',
    subTel: subTelInput.value.trim() || 'మీ కలల ఇల్లు ఇప్పుడు మీ చేతుల్లోనే!',
    bullets: bulletsInput.value.trim() || '₹5 లక్షల నుండి ₹1 కోటి వరకు లోన్, తక్కువ వడ్డీ రేట్లు, డోర్‌స్టెప్ డాక్యుమెంటేషన్',
    phone: phoneInput.value.trim() || '90148 33945',
    site: siteInput.value.trim() || 'www.raghavaconsultency.com'
  };
  await draw(data, width, height);
}

// download at size
function downloadCanvas(filename, width=1080, height=1920){
  return new Promise(async (resolve)=>{
    await renderAd(width, height);
    const dataURL = canvas.toDataURL('image/png');
    const link = document.createElement('a');
    link.href = dataURL;
    link.download = filename;
    document.body.appendChild(link); link.click(); link.remove();
    resolve();
  });
}

// events
renderBtn.addEventListener('click', ()=> renderAd());
downloadBtn.addEventListener('click', async ()=> { await downloadCanvas('raghava_ad_1080x1920.png', 1080, 1920); });
downloadPoster.addEventListener('click', async ()=> { await downloadCanvas('raghava_poster_2000x3000.png', 2000, 3000); });
downloadSet.addEventListener('click', async ()=>{
  await downloadCanvas('raghava_ad_1080x1920.png', 1080, 1920);
  await new Promise(r=>setTimeout(r,200));
  await downloadCanvas('raghava_poster_2000x3000.png', 2000, 3000);
});

// initial render
window.addEventListener('load', ()=> { setTimeout(()=> renderAd(), 240); });
</script>

</body>
</html>
