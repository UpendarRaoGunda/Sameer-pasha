<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Raghava Consultency ‚Äî Ad Generator</title>

  <!-- Fonts -->
  <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+Telugu:wght@400;700&family=Poppins:wght@300;500;700;900&display=swap" rel="stylesheet">

  <style>
    :root {
      --primary: #f5b041;
      --primary-dark: #e4a13b;
      --secondary: #2b9ed7;
      --secondary-dark: #2688c8;
      --accent: #6f4bd7;
      --success: #3dd6a5;
      --dark: #061226;
      --dark-light: #0a1e35;
      --light: #e6eef7;
      --gray: #9ec6e3;
      --gray-light: #bcd6eb;
      --border: rgba(255,255,255,0.08);
      --card-bg: rgba(255,255,255,0.03);
      --shadow: 0 10px 30px rgba(2,10,20,0.6);
      --radius: 12px;
      --transition: all 0.3s ease;
    }

    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
    }

    body {
      margin: 0;
      min-height: 100vh;
      font-family: "Poppins", system-ui, -apple-system, "Segoe UI", Roboto, Arial;
      background: linear-gradient(135deg, #052238 0%, #07172a 100%);
      color: var(--light);
      display: flex;
      gap: 24px;
      padding: 24px;
      align-items: flex-start;
      justify-content: center;
      position: relative;
      overflow-x: hidden;
    }

    body::before {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: 
        radial-gradient(900px 450px at 10% 10%, rgba(11,95,138,0.10), transparent 6%),
        radial-gradient(800px 800px at 90% 90%, rgba(245,180,66,0.05), transparent 30%);
      pointer-events: none;
      z-index: -1;
    }

    .app-container {
      display: flex;
      gap: 24px;
      max-width: 1400px;
      width: 100%;
    }

    .sidebar {
      width: 380px;
      background: var(--card-bg);
      border-radius: var(--radius);
      padding: 24px;
      box-shadow: var(--shadow);
      border: 1px solid var(--border);
      backdrop-filter: blur(10px);
      display: flex;
      flex-direction: column;
      gap: 20px;
    }

    .app-header {
      display: flex;
      align-items: center;
      gap: 12px;
      margin-bottom: 8px;
    }

    .app-icon {
      width: 40px;
      height: 40px;
      background: linear-gradient(135deg, var(--primary), var(--primary-dark));
      border-radius: 10px;
      display: flex;
      align-items: center;
      justify-content: center;
      color: var(--dark);
      font-weight: 900;
      font-size: 18px;
    }

    .app-title {
      font-size: 18px;
      font-weight: 700;
      margin: 0;
    }

    .app-subtitle {
      font-size: 13px;
      color: var(--gray);
      margin-top: -4px;
      margin-bottom: 16px;
    }

    .section {
      display: flex;
      flex-direction: column;
      gap: 12px;
    }

    .section-title {
      font-size: 15px;
      font-weight: 600;
      color: var(--gray-light);
      display: flex;
      align-items: center;
      gap: 8px;
    }

    .section-title::before {
      content: '';
      display: block;
      width: 4px;
      height: 16px;
      background: var(--primary);
      border-radius: 2px;
    }

    .template-list {
      display: flex;
      gap: 8px;
      margin-top: 4px;
    }

    .template-item {
      flex: 1;
      padding: 12px 8px;
      text-align: center;
      border-radius: 10px;
      cursor: pointer;
      font-weight: 600;
      background: transparent;
      color: var(--gray-light);
      border: 1px solid transparent;
      transition: var(--transition);
      font-size: 13px;
    }

    .template-item:hover {
      background: rgba(255,255,255,0.05);
    }

    .template-item.active {
      background: rgba(255,255,255,0.08);
      border: 1px solid rgba(255,255,255,0.1);
      color: var(--primary);
      box-shadow: 0 4px 12px rgba(0,0,0,0.2);
    }

    label {
      display: block;
      font-size: 13px;
      color: var(--gray-light);
      margin-bottom: 6px;
      font-weight: 500;
    }

    .input-group {
      margin-bottom: 8px;
    }

    input[type="text"], textarea, select {
      width: 100%;
      padding: 12px 16px;
      border-radius: 10px;
      border: 1px solid var(--border);
      background: rgba(255,255,255,0.04);
      color: var(--light);
      outline: none;
      font-size: 14px;
      transition: var(--transition);
      font-family: inherit;
    }

    input[type="text"]:focus, textarea:focus, select:focus {
      border-color: var(--primary);
      box-shadow: 0 0 0 2px rgba(245, 180, 65, 0.2);
    }

    textarea {
      min-height: 80px;
      resize: vertical;
    }

    .row {
      display: flex;
      gap: 12px;
    }

    .small {
      flex: 1;
    }

    .file-input-wrapper {
      position: relative;
      overflow: hidden;
      display: inline-block;
      width: 100%;
    }

    .file-input-wrapper input[type=file] {
      position: absolute;
      left: 0;
      top: 0;
      opacity: 0;
      width: 100%;
      height: 100%;
      cursor: pointer;
    }

    .file-input-button {
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 8px;
      width: 100%;
      padding: 12px 16px;
      background: rgba(255,255,255,0.04);
      border: 1px dashed var(--border);
      border-radius: 10px;
      color: var(--gray);
      font-size: 13px;
      transition: var(--transition);
      cursor: pointer;
    }

    .file-input-button:hover {
      background: rgba(255,255,255,0.06);
      border-color: var(--primary);
    }

    .file-input-button i {
      font-size: 16px;
    }

    .btn {
      display: inline-flex;
      align-items: center;
      justify-content: center;
      gap: 8px;
      width: 100%;
      padding: 14px;
      border-radius: 10px;
      border: none;
      cursor: pointer;
      font-weight: 700;
      font-size: 14px;
      color: var(--dark);
      background: linear-gradient(135deg, var(--primary), var(--primary-dark));
      box-shadow: 0 8px 24px rgba(245,180,66,0.16);
      transition: var(--transition);
    }

    .btn:hover {
      transform: translateY(-2px);
      box-shadow: 0 12px 28px rgba(245,180,66,0.24);
    }

    .btn.secondary {
      background: linear-gradient(135deg, var(--secondary), var(--secondary-dark));
      color: white;
      box-shadow: 0 8px 24px rgba(34,120,180,0.12);
    }

    .btn.secondary:hover {
      box-shadow: 0 12px 28px rgba(34,120,180,0.2);
    }

    .btn.accent {
      background: linear-gradient(135deg, var(--accent), #9b6cf2);
    }

    .btn.success {
      background: linear-gradient(135deg, var(--success), #18b686);
    }

    .btn-group {
      display: flex;
      gap: 12px;
    }

    .controls {
      display: flex;
      gap: 8px;
      margin-top: 8px;
    }

    .preview-container {
      flex: 1;
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 16px;
    }

    .canvas-container {
      position: relative;
      width: 360px;
      height: 640px;
      border-radius: 16px;
      overflow: hidden;
      box-shadow: 0 20px 60px rgba(3,12,28,0.8);
      background: white;
      transition: var(--transition);
    }

    .canvas-container:hover {
      transform: translateY(-5px);
      box-shadow: 0 25px 70px rgba(3,12,28,0.9);
    }

    canvas {
      width: 100%;
      height: 100%;
      display: block;
    }

    .preview-info {
      color: var(--gray);
      font-size: 13px;
      text-align: center;
      max-width: 360px;
      line-height: 1.5;
    }

    .preview-actions {
      display: flex;
      gap: 12px;
      margin-top: 8px;
    }

    .preview-action-btn {
      padding: 8px 16px;
      background: rgba(255,255,255,0.05);
      border: 1px solid var(--border);
      border-radius: 8px;
      color: var(--gray-light);
      font-size: 12px;
      cursor: pointer;
      transition: var(--transition);
    }

    .preview-action-btn:hover {
      background: rgba(255,255,255,0.08);
      color: var(--light);
    }

    .status-message {
      padding: 12px 16px;
      border-radius: 10px;
      background: rgba(61, 214, 165, 0.1);
      border: 1px solid rgba(61, 214, 165, 0.2);
      color: var(--success);
      font-size: 13px;
      text-align: center;
      margin-top: 8px;
      display: none;
    }

    .status-message.show {
      display: block;
      animation: fadeIn 0.3s ease;
    }

    @keyframes fadeIn {
      from { opacity: 0; transform: translateY(-10px); }
      to { opacity: 1; transform: translateY(0); }
    }

    .tooltip {
      position: relative;
      display: inline-block;
    }

    .tooltip .tooltip-text {
      visibility: hidden;
      width: 200px;
      background-color: rgba(0,0,0,0.8);
      color: #fff;
      text-align: center;
      border-radius: 6px;
      padding: 8px;
      position: absolute;
      z-index: 1;
      bottom: 125%;
      left: 50%;
      transform: translateX(-50%);
      opacity: 0;
      transition: opacity 0.3s;
      font-size: 12px;
      font-weight: normal;
    }

    .tooltip:hover .tooltip-text {
      visibility: visible;
      opacity: 1;
    }

    /* Responsive adjustments */
    @media (max-width: 1200px) {
      .app-container {
        flex-direction: column;
        align-items: center;
      }
      
      .sidebar {
        width: 100%;
        max-width: 600px;
      }
      
      .preview-container {
        width: 100%;
      }
    }
  </style>
</head>
<body>

  <div class="app-container">
    <aside class="sidebar" aria-label="controls">
      <div class="app-header">
        <div class="app-icon">RC</div>
        <div>
          <h1 class="app-title">Raghava Consultency</h1>
          <div class="app-subtitle">Professional Ad Generator</div>
        </div>
      </div>

      <div class="section">
        <h2 class="section-title">Template</h2>
        <div class="template-list" role="tablist">
          <div class="template-item active" data-template="classic">Classic</div>
          <div class="template-item" data-template="modern">Modern</div>
          <div class="template-item" data-template="luxe">Luxe</div>
        </div>
      </div>

      <div class="section">
        <h2 class="section-title">Content</h2>
        
        <div class="input-group">
          <label for="headlineTel">Telugu Headline</label>
          <input id="headlineTel" type="text" value="‡∞∞‡∞æ‡∞ò‡∞µ ‡∞ï‡∞®‡±ç‡∞∏‡∞≤‡±ç‡∞ü‡±Ü‡∞®‡±ç‡∞∏‡±Ä ‚Äî ‡∞π‡±ã‡∞Æ‡±ç ‡∞≤‡±ã‡∞®‡±ç‡∞∏‡±ç & ‡∞Æ‡∞æ‡∞∞‡±ç‡∞ü‡±ç‡∞ó‡±á‡∞ú‡±ç ‡∞≤‡±ã‡∞®‡±ç‡∞∏‡±ç">
        </div>

        <div class="input-group">
          <label for="subTel">Telugu Subheading</label>
          <input id="subTel" type="text" value="‡∞Æ‡±Ä ‡∞ï‡∞≤‡∞≤ ‡∞á‡∞≤‡±ç‡∞≤‡±Å ‡∞á‡∞™‡±ç‡∞™‡±Å‡∞°‡±Å ‡∞Æ‡±Ä ‡∞ö‡±á‡∞§‡±Å‡∞≤‡±ç‡∞≤‡±ã‡∞®‡±á!">
        </div>

        <div class="input-group">
          <label for="bullets">Bullets (comma-separated)</label>
          <input id="bullets" type="text" value="‚Çπ5 ‡∞≤‡∞ï‡±ç‡∞∑‡∞≤ ‡∞®‡±Å‡∞Ç‡∞°‡∞ø ‚Çπ1 ‡∞ï‡±ã‡∞ü‡∞ø ‡∞µ‡∞∞‡∞ï‡±Å ‡∞≤‡±ã‡∞®‡±ç, ‡∞§‡∞ï‡±ç‡∞ï‡±Å‡∞µ ‡∞µ‡∞°‡±ç‡∞°‡±Ä ‡∞∞‡±á‡∞ü‡±ç‡∞≤‡±Å & ‡∞µ‡±á‡∞ó‡∞µ‡∞Ç‡∞§‡∞Æ‡±à‡∞® ‡∞Æ‡∞Ç‡∞ú‡±Ç‡∞∞‡±Å, ‡∞°‡±ã‡∞∞‡±ç‚Äå‡∞∏‡±ç‡∞ü‡±Ü‡∞™‡±ç ‡∞°‡∞æ‡∞ï‡±ç‡∞Ø‡±Å‡∞Æ‡±Ü‡∞Ç‡∞ü‡±á‡∞∑‡∞®‡±ç">
        </div>

        <div class="row">
          <div class="small">
            <label for="phone">Phone</label>
            <input id="phone" type="text" value="90148 33945">
          </div>
          <div class="small">
            <label for="site">Website</label>
            <input id="site" type="text" value="www.raghavaconsultency.com">
          </div>
        </div>
      </div>

      <div class="section">
        <h2 class="section-title">Media</h2>
        
        <div class="input-group">
          <label for="photoFile">Upload Photo (optional)</label>
          <div class="file-input-wrapper">
            <div class="file-input-button">
              <i>üì∑</i> Choose Photo
            </div>
            <input id="photoFile" type="file" accept="image/*">
          </div>
        </div>

        <div class="input-group">
          <label for="logoFile">Upload Logo (optional)</label>
          <div class="file-input-wrapper">
            <div class="file-input-button">
              <i>üè¢</i> Choose Logo
            </div>
            <input id="logoFile" type="file" accept="image/*">
          </div>
        </div>
      </div>

      <div class="section">
        <h2 class="section-title">Actions</h2>
        
        <div class="btn-group">
          <button id="renderBtn" class="btn">
            <i>üîÑ</i> Render Ad
          </button>
          <button id="downloadBtn" class="btn secondary">
            <i>üì•</i> Download
          </button>
        </div>

        <div class="btn-group">
          <button id="downloadPoster" class="btn accent">
            <i>üñºÔ∏è</i> Poster (2000√ó3000)
          </button>
          <button id="downloadSet" class="btn success">
            <i>üì¶</i> All Sizes
          </button>
        </div>
      </div>

      <div class="status-message" id="statusMessage">
        Ad rendered successfully! Ready to download.
      </div>

      <div class="tooltip" style="margin-top: 8px;">
        <div style="color: var(--gray); font-size: 13px; text-align: center;">
          üí° Tip: Test with lengthy Telugu text to verify auto-adjustment
        </div>
        <span class="tooltip-text">The layout automatically adjusts to prevent overlapping elements when text is longer</span>
      </div>
    </aside>

    <main class="preview-container" aria-live="polite">
      <div class="canvas-container">
        <canvas id="adCanvas" width="1080" height="1920" role="img" aria-label="Ad preview"></canvas>
      </div>
      
      <div class="preview-info">
        Preview (scaled). Click Render then Download. Templates: Classic / Modern / Luxe
      </div>
      
      <div class="preview-actions">
        <button class="preview-action-btn" id="zoomInBtn">Zoom In</button>
        <button class="preview-action-btn" id="zoomOutBtn">Zoom Out</button>
        <button class="preview-action-btn" id="resetZoomBtn">Reset Zoom</button>
      </div>
    </main>
  </div>

<script>
/* Complete fixed ad generator:
   - Dynamic measurement to avoid overlapping bullets and portrait
   - Photo & logo upload
   - Multiple templates and downloads
*/

// DOM elements
const canvas = document.getElementById('adCanvas');
const ctx = canvas.getContext('2d', { alpha: false });
const renderBtn = document.getElementById('renderBtn');
const downloadBtn = document.getElementById('downloadBtn');
const downloadPoster = document.getElementById('downloadPoster');
const downloadSet = document.getElementById('downloadSet');
const statusMessage = document.getElementById('statusMessage');
const zoomInBtn = document.getElementById('zoomInBtn');
const zoomOutBtn = document.getElementById('zoomOutBtn');
const resetZoomBtn = document.getElementById('resetZoomBtn');

const headlineTelInput = document.getElementById('headlineTel');
const subTelInput = document.getElementById('subTel');
const bulletsInput = document.getElementById('bullets');
const phoneInput = document.getElementById('phone');
const siteInput = document.getElementById('site');
const photoFile = document.getElementById('photoFile');
const logoFile = document.getElementById('logoFile');
const templateItems = Array.from(document.querySelectorAll('.templateItem'));

let activeTemplate = 'classic';
let zoomLevel = 1;

templateItems.forEach(it => it.addEventListener('click', ()=> {
  templateItems.forEach(i=>i.classList.remove('active'));
  it.classList.add('active');
  activeTemplate = it.dataset.template;
  showStatus('Template changed to ' + it.textContent);
}));

// uploaded images
let uploadedPhoto = null;
let uploadedLogo = null;
photoFile.addEventListener('change', e => {
  const f = e.target.files[0];
  if(!f) return;
  const url = URL.createObjectURL(f);
  loadImage(url).then(img => { 
    uploadedPhoto = img; 
    URL.revokeObjectURL(url); 
    showStatus('Photo uploaded successfully');
  }).catch(()=>{ 
    uploadedPhoto=null; 
    showStatus('Failed to load photo', true);
  });
});
logoFile.addEventListener('change', e => {
  const f = e.target.files[0];
  if(!f) return;
  const url = URL.createObjectURL(f);
  loadImage(url).then(img => { 
    uploadedLogo = img; 
    URL.revokeObjectURL(url); 
    showStatus('Logo uploaded successfully');
  }).catch(()=>{ 
    uploadedLogo=null; 
    showStatus('Failed to load logo', true);
  });
});

// Zoom functionality
zoomInBtn.addEventListener('click', () => {
  if (zoomLevel < 2) {
    zoomLevel += 0.1;
    updateCanvasZoom();
  }
});

zoomOutBtn.addEventListener('click', () => {
  if (zoomLevel > 0.5) {
    zoomLevel -= 0.1;
    updateCanvasZoom();
  }
});

resetZoomBtn.addEventListener('click', () => {
  zoomLevel = 1;
  updateCanvasZoom();
});

function updateCanvasZoom() {
  const container = document.querySelector('.canvas-container');
  container.style.transform = `scale(${zoomLevel})`;
  showStatus(`Zoom: ${Math.round(zoomLevel * 100)}%`);
}

// Status message function
function showStatus(message, isError = false) {
  statusMessage.textContent = message;
  statusMessage.style.background = isError 
    ? 'rgba(255, 100, 100, 0.1)' 
    : 'rgba(61, 214, 165, 0.1)';
  statusMessage.style.borderColor = isError 
    ? 'rgba(255, 100, 100, 0.2)' 
    : 'rgba(61, 214, 165, 0.2)';
  statusMessage.style.color = isError 
    ? '#ff6464' 
    : 'var(--success)';
  
  statusMessage.classList.add('show');
  setTimeout(() => {
    statusMessage.classList.remove('show');
  }, 3000);
}

// helper: load HTMLImageElement
function loadImage(src){
  return new Promise((resolve,reject)=>{
    const img = new Image();
    img.crossOrigin = "anonymous";
    img.onload = ()=> resolve(img);
    img.onerror = reject;
    img.src = src;
  });
}

// rounding helper
function roundRectPath(ctx,x,y,w,h,r){
  ctx.beginPath();
  ctx.moveTo(x+r,y);
  ctx.arcTo(x+w,y,x+w,y+h,r);
  ctx.arcTo(x+w,y+h,x,y+h,r);
  ctx.arcTo(x,y+h,x,y,r);
  ctx.arcTo(x,y,x+w,y,r);
  ctx.closePath();
}

// simple house icon drawer
function drawHouseIcon(ctx,x,y,size,fill){
  ctx.save();
  ctx.translate(x,y);
  ctx.beginPath();
  ctx.moveTo(0,-size*0.35);
  ctx.lineTo(-size*0.45,0);
  ctx.lineTo(-size*0.45,size*0.35);
  ctx.lineTo(size*0.45,size*0.35);
  ctx.lineTo(size*0.45,0);
  ctx.closePath();
  ctx.fillStyle = fill;
  ctx.fill();
  ctx.restore();
}

// measure wrapped lines (returns array)
function measureWrappedLines(ctx, text, maxWidth){
  const words = text.split(' ');
  let line = '';
  const lines = [];
  for(let n=0;n<words.length;n++){
    const testLine = line + words[n] + ' ';
    const metrics = ctx.measureText(testLine);
    if(metrics.width > maxWidth && n > 0){
      lines.push(line.trim());
      line = words[n] + ' ';
    } else {
      line = testLine;
    }
  }
  if(line.trim().length) lines.push(line.trim());
  return lines;
}

// draw array of lines at x,y with lineHeight. align: 'left'|'center'
function drawWrappedText(ctx, lines, x, y, lineHeight, align='left'){
  ctx.textAlign = align;
  for(let i=0;i<lines.length;i++){
    ctx.fillText(lines[i], x, y + (i * lineHeight));
  }
  return lines.length * lineHeight;
}

// main draw function (dynamic)
async function draw(data, width=1080, height=1920){
  await document.fonts.ready;
  canvas.width = width;
  canvas.height = height;

  // background per template
  if(activeTemplate === 'classic'){
    const g = ctx.createLinearGradient(0,0,0,height);
    g.addColorStop(0,'#07243a'); g.addColorStop(0.45,'#06334f'); g.addColorStop(1,'#041226');
    ctx.fillStyle = g; ctx.fillRect(0,0,width,height);
  } else if(activeTemplate === 'modern'){
    const g = ctx.createLinearGradient(0,0,width,height);
    g.addColorStop(0,'#06293a'); g.addColorStop(1,'#0b4b6b');
    ctx.fillStyle = g; ctx.fillRect(0,0,width,height);
  } else {
    const g = ctx.createLinearGradient(0,0,0,height);
    g.addColorStop(0,'#081224'); g.addColorStop(0.6,'#0d2540'); g.addColorStop(1,'#0b1220');
    ctx.fillStyle = g; ctx.fillRect(0,0,width,height);
    const vign = ctx.createRadialGradient(width*0.5, height*0.36, 200, width*0.5, height*0.36, Math.max(width,height));
    vign.addColorStop(0,'rgba(245,180,66,0.08)'); vign.addColorStop(1,'rgba(0,0,0,0)');
    ctx.fillStyle = vign; ctx.fillRect(0,0,width,height);
  }

  // central warm glow
  const glow = ctx.createRadialGradient(width/2, height*0.36, 10, width/2, height*0.36, 900);
  glow.addColorStop(0,'rgba(245,180,66,0.95)');
  glow.addColorStop(0.15,'rgba(245,180,66,0.28)');
  glow.addColorStop(0.35,'rgba(0,0,0,0.02)');
  glow.addColorStop(1,'rgba(0,0,0,0)');
  ctx.fillStyle = glow; ctx.fillRect(0,0,width,height);

  // subtle skyline
  ctx.save();
  ctx.globalAlpha = 0.06; ctx.fillStyle = '#000';
  for(let i=0;i<12;i++){ const wRect = 80 + (i%4)*30; const hRect = 140 + (i%5)*60; const x = i * 90; const y = height*0.58 - hRect; ctx.fillRect(x,y,wRect,hRect); }
  ctx.restore();

  // house area
  const houseW = Math.round(width*0.5);
  const houseH = Math.round(height*0.21);
  const houseX = Math.round(width*0.06);
  const houseY = Math.round(height*0.48);
  roundRectPath(ctx, houseX, houseY, houseW, houseH, 24);
  ctx.fillStyle = 'rgba(255,255,255,0.04)'; ctx.fill();

  // windows
  ctx.fillStyle = '#ffdca2'; ctx.fillRect(houseX+60, houseY+40, 140, 90); ctx.fillRect(houseX+240, houseY+40, 120,90); ctx.fillRect(houseX+420, houseY+40, 80,90);
  // roof
  ctx.beginPath(); ctx.moveTo(houseX-20, houseY+10); ctx.lineTo(houseX+houseW/2, houseY-110); ctx.lineTo(houseX+houseW+20, houseY+10); ctx.closePath(); ctx.fillStyle='rgba(0,0,0,0.12)'; ctx.fill();
  ctx.strokeStyle='rgba(245,180,66,0.08)'; ctx.lineWidth=4; ctx.stroke();

  // draw logo or text top-left
  if(uploadedLogo){
    const lW = Math.round(width*0.18), lH = Math.round(width*0.06), lx = Math.round(width*0.06), ly = Math.round(height*0.06);
    roundRectPath(ctx, lx-8, ly-8, lW+16, lH+16, 12); ctx.fillStyle='rgba(0,0,0,0.16)'; ctx.fill();
    const img = uploadedLogo;
    const ratio = Math.min(lW/img.width, lH/img.height);
    const drawW = img.width * ratio; const drawH = img.height * ratio;
    const drawX = lx + (lW - drawW)/2; const drawY = ly + (lH - drawH)/2;
    ctx.drawImage(img, drawX, drawY, drawW, drawH);
  } else {
    ctx.font = '700 32px Poppins, sans-serif'; ctx.fillStyle = '#ffdca2'; ctx.textAlign = 'left'; ctx.fillText('RaghavaConsultency', width*0.06, height*0.09);
  }

  // headline (Telugu)
  ctx.font = `700 ${Math.round(width*0.055)}px "Noto Sans Telugu", Poppins, sans-serif`;
  ctx.fillStyle = '#fffaf0'; ctx.textAlign = 'center';
  wrapAndDraw(ctx, data.headlineTel, width/2, height*0.14, width - 120, Math.round(width*0.07));

  // subheading
  ctx.font = `600 ${Math.round(width*0.035)}px "Noto Sans Telugu", Poppins, sans-serif`;
  ctx.fillStyle = 'rgba(255,255,255,0.92)';
  wrapAndDraw(ctx, data.subTel, width/2, height*0.205, width - 160, Math.round(width*0.044));

  // BULLETS & PORTRAIT (DYNAMIC)
  // constants
  const bullets = data.bullets.split(',').map(s=>s.trim()).filter(Boolean).slice(0,8);
  const bulletsFontSize = Math.round(width*0.034);
  ctx.font = `500 ${bulletsFontSize}px "Noto Sans Telugu", Poppins, sans-serif`;
  const bulletsMaxWidth = Math.round(width * 0.36); // available width for bullet text
  const bulletsX = Math.round(width * 0.58);
  let bulletsY = Math.round(height * 0.52);
  const bulletLineHeight = Math.round(width * 0.048);

  // measure each bullet (lines & height)
  const measured = bullets.map(b => {
    const lines = measureWrappedLines(ctx, b, bulletsMaxWidth);
    return { text: b, lines, height: lines.length * bulletLineHeight };
  });

  // total bullets height with small spacing
  const bulletsTotalHeight = measured.reduce((acc,m)=> acc + m.height + Math.round(width*0.015), 0);

  // portrait candidate
  const portraitSize = Math.round(width*0.22);
  let portraitX = Math.round(width * 0.74);
  let portraitY = Math.round(height * 0.50);

  // compute vertical ranges
  const bulletsTop = bulletsY;
  const bulletsBottom = bulletsY + bulletsTotalHeight;
  const portraitTop = portraitY - portraitSize/2;
  const portraitBottom = portraitY + portraitSize/2;

  // if vertical overlap (and horizontal proximity) -> move portrait below bullets
  if (!( (bulletsBottom < portraitTop - 20) || (bulletsTop > portraitBottom + 20) )){
    portraitY = bulletsBottom + portraitSize/2 + Math.round(width*0.04);
  }

  // draw bullets now (icons + wrapped lines)
  ctx.fillStyle = 'rgba(255,255,255,0.96)';
  let currentY = bulletsY;
  measured.forEach((m, idx) => {
    // bullet circle
    ctx.beginPath();
    ctx.arc(bulletsX - 70, currentY + 6, 22, 0, Math.PI*2);
    ctx.fillStyle = '#ffdca2'; ctx.fill();
    // small house icon inside circle
    ctx.save(); ctx.fillStyle = '#0b2740'; drawHouseIcon(ctx, bulletsX - 77, currentY - 6, 26, '#0b2740'); ctx.restore();
    // draw wrapped lines
    ctx.fillStyle = '#fff';
    drawWrappedText(ctx, m.lines, bulletsX - 20, currentY + 6, bulletLineHeight, 'left');
    currentY += m.height + Math.round(width*0.015);
  });

  // Draw portrait (clipped) at portraitX, portraitY
  if(uploadedPhoto){
    const px = portraitX, py = portraitY, pSize = portraitSize;
    ctx.save();
    // soft shadow behind circle
    ctx.beginPath();
    ctx.arc(px, py - 20, pSize/2 + 8, 0, Math.PI*2);
    ctx.fillStyle = 'rgba(0,0,0,0.18)'; ctx.fill();
    // clip circle and draw photo as cover
    ctx.beginPath(); ctx.arc(px, py - 20, pSize/2, 0, Math.PI*2); ctx.closePath(); ctx.clip();
    const img = uploadedPhoto;
    let sx=0, sy=0, sw=img.width, sh=img.height;
    const ratio = img.width / img.height;
    if(ratio > 1){ sw = img.height; sx = Math.round((img.width - sw)/2); } else { sh = img.width; sy = Math.round((img.height - sh)/2); }
    ctx.drawImage(img, sx, sy, sw, sh, px - pSize/2, py - 20 - pSize/2, pSize, pSize);
    ctx.restore();
  } else {
    // placeholder
    const px = portraitX, py = portraitY, pSize = portraitSize;
    ctx.beginPath(); ctx.arc(px, py - 20, pSize/2, 0, Math.PI*2); ctx.fillStyle = 'rgba(255,255,255,0.06)'; ctx.fill();
    ctx.font = `700 ${Math.round(pSize*0.28)}px Poppins, sans-serif`; ctx.fillStyle = '#ffdca2'; ctx.textAlign='center'; ctx.textBaseline='middle';
    ctx.fillText('HP', px, py - 20);
  }

  // CONTACT BLOCK bottom center
  const cH = Math.round(height*0.14);
  const cW = Math.round(width*0.86);
  const cX = Math.round((width - cW)/2);
  const cY = Math.round(height*0.74);
  roundRectPath(ctx, cX, cY, cW, cH, 18); ctx.fillStyle = 'rgba(0,0,0,0.22)'; ctx.fill();

  ctx.font = `800 ${Math.round(width*0.055)}px Poppins, sans-serif`; ctx.fillStyle='#fff'; ctx.textAlign='center';
  ctx.fillText(data.phone, width/2, cY + (cH*0.45));

  ctx.font = `500 ${Math.round(width*0.032)}px Poppins, sans-serif`; ctx.fillStyle = 'rgba(255,255,255,0.84)';
  ctx.fillText(data.site, width/2, cY + (cH*0.75));

  // brand name
  ctx.font = `900 ${Math.round(width*0.05)}px Poppins, sans-serif`; ctx.fillStyle='#ffdca2'; ctx.fillText('RAGHAVA Consultency', width/2, height*0.925);

  // tagline
  ctx.font = `500 ${Math.round(width*0.03)}px Poppins, sans-serif`; ctx.fillStyle='rgba(255,255,255,0.9)'; ctx.fillText('Transforming Dreams into Homes.', width/2, height*0.96);

  // footer small
  ctx.font = `400 ${Math.round(width*0.02)}px Poppins, sans-serif`; ctx.fillStyle='rgba(255,255,255,0.12)'; ctx.fillText('Associated with major Banks & NBFCs', width/2, height*0.986);
}

// small helper: wrap and draw (used for headline/sub)
function wrapAndDraw(ctx, text, x, y, maxWidth, lineHeight){
  const font = ctx.font;
  const lines = measureWrappedLines(ctx, text, maxWidth);
  for(let i=0;i<lines.length;i++){
    ctx.fillText(lines[i], x, y + (i * lineHeight));
  }
  ctx.font = font;
}

// render driver
async function renderAd(width=1080, height=1920){
  const data = {
    headlineTel: headlineTelInput.value.trim() || '‡∞∞‡∞æ‡∞ò‡∞µ ‡∞ï‡∞®‡±ç‡∞∏‡∞≤‡±ç‡∞ü‡±Ü‡∞®‡±ç‡∞∏‡±Ä ‚Äî ‡∞π‡±ã‡∞Æ‡±ç ‡∞≤‡±ã‡∞®‡±ç‡∞∏‡±ç',
    subTel: subTelInput.value.trim() || '‡∞Æ‡±Ä ‡∞ï‡∞≤‡∞≤ ‡∞á‡∞≤‡±ç‡∞≤‡±Å ‡∞á‡∞™‡±ç‡∞™‡±Å‡∞°‡±Å ‡∞Æ‡±Ä ‡∞ö‡±á‡∞§‡±Å‡∞≤‡±ç‡∞≤‡±ã‡∞®‡±á!',
    bullets: bulletsInput.value.trim() || '‚Çπ5 ‡∞≤‡∞ï‡±ç‡∞∑‡∞≤ ‡∞®‡±Å‡∞Ç‡∞°‡∞ø ‚Çπ1 ‡∞ï‡±ã‡∞ü‡∞ø ‡∞µ‡∞∞‡∞ï‡±Å ‡∞≤‡±ã‡∞®‡±ç, ‡∞§‡∞ï‡±ç‡∞ï‡±Å‡∞µ ‡∞µ‡∞°‡±ç‡∞°‡±Ä ‡∞∞‡±á‡∞ü‡±ç‡∞≤‡±Å, ‡∞°‡±ã‡∞∞‡±ç‚Äå‡∞∏‡±ç‡∞ü‡±Ü‡∞™‡±ç ‡∞°‡∞æ‡∞ï‡±ç‡∞Ø‡±Å‡∞Æ‡±Ü‡∞Ç‡∞ü‡±á‡∞∑‡∞®‡±ç',
    phone: phoneInput.value.trim() || '90148 33945',
    site: siteInput.value.trim() || 'www.raghavaconsultency.com'
  };
  await draw(data, width, height);
  showStatus('Ad rendered successfully!');
}

// download at size
function downloadCanvas(filename, width=1080, height=1920){
  return new Promise(async (resolve)=>{
    await renderAd(width, height);
    const dataURL = canvas.toDataURL('image/png');
    const link = document.createElement('a');
    link.href = dataURL;
    link.download = filename;
    document.body.appendChild(link); link.click(); link.remove();
    resolve();
  });
}

// events
renderBtn.addEventListener('click', ()=> renderAd());
downloadBtn.addEventListener('click', async ()=> { 
  await downloadCanvas('raghava_ad_1080x1920.png', 1080, 1920); 
  showStatus('Downloaded: raghava_ad_1080x1920.png');
});
downloadPoster.addEventListener('click', async ()=> { 
  await downloadCanvas('raghava_poster_2000x3000.png', 2000, 3000); 
  showStatus('Downloaded: raghava_poster_2000x3000.png');
});
downloadSet.addEventListener('click', async ()=>{
  await downloadCanvas('raghava_ad_1080x1920.png', 1080, 1920);
  await new Promise(r=>setTimeout(r,200));
  await downloadCanvas('raghava_poster_2000x3000.png', 2000, 3000);
  showStatus('All sizes downloaded successfully!');
});

// initial render
window.addEventListener('load', ()=> { 
  setTimeout(()=> {
    renderAd(); 
    showStatus('Welcome to Raghava Consultency Ad Generator');
  }, 500); 
});
</script>

</body>
</html>
