<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Raghava Consultency ‚Äî Ad Generator (Enhanced)</title>

  <!-- Fonts -->
  <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+Telugu:wght@400;700&family=Poppins:wght@300;500;700;900&display=swap" rel="stylesheet">

  <style>
    :root{
      --w:1080; --h:1920;
      --gold:#f5b041;
    }
    *{box-sizing:border-box}
    body{
      margin:0;
      min-height:100vh;
      font-family: "Poppins", system-ui, -apple-system, "Segoe UI", Roboto, Arial;
      background:
        radial-gradient(900px 450px at 10% 10%, rgba(11,95,138,0.10), transparent 6%),
        linear-gradient(180deg,#052238 0%, #07172a 100%);
      color:#e6eef7;
      display:flex;
      gap:20px;
      padding:28px;
      align-items:flex-start;
      justify-content:center;
    }

    .sidebar{
      width:380px;
      background: linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01));
      border-radius:12px;
      padding:16px;
      box-shadow:0 10px 30px rgba(2,10,20,0.6);
      border:1px solid rgba(255,255,255,0.03);
    }
    .sidebar h1{font-size:18px;margin:0 0 10px 0}
    label{display:block;font-size:13px;color:#bcd6eb;margin-top:10px}
    input[type="text"], textarea, select{width:100%; padding:10px 12px; margin-top:6px; border-radius:8px; border:1px solid rgba(255,255,255,0.06); background: rgba(255,255,255,0.02); color:var(--gold); outline:none; font-size:14px;}
    textarea{min-height:70px; resize:vertical}
    .row{display:flex; gap:8px}
    .small{flex:1}
    .btn{display:inline-block; width:100%; padding:12px; margin-top:12px; border-radius:10px; border:none; cursor:pointer; font-weight:700; font-size:14px; color:#061226; background: linear-gradient(90deg,var(--gold), #e4a13b); box-shadow: 0 8px 24px rgba(245,180,66,0.16);}
    .btn.secondary{background:linear-gradient(90deg,#2b9ed7,#2688c8); color:white; box-shadow:0 8px 24px rgba(34,120,180,0.12);}
    .controls{display:flex; gap:8px; margin-top:8px}
    .previewWrap{width:420px; display:flex; flex-direction:column; align-items:center; gap:10px}
    canvas{ width:360px; height:640px; border-radius:14px; box-shadow: 0 20px 60px rgba(3,12,28,0.6); background:white;}
    .templateList{display:flex; gap:8px; margin-top:8px}
    .templateItem{flex:1; padding:8px; text-align:center; border-radius:10px; cursor:pointer; font-weight:600; background:transparent; color:#cfe8ff; border:1px solid transparent}
    .templateItem.active{background:rgba(255,255,255,0.03); border:1px solid rgba(255,255,255,0.04)}
    .meta{color:#9ec6e3; font-size:13px; text-align:center}
  </style>
</head>
<body>

  <aside class="sidebar" aria-label="controls">
    <h1>Raghava Consultency ‚Äî Ad Maker (Enhanced)</h1>

    <label>Template</label>
    <div class="templateList" role="tablist">
      <div class="templateItem active" data-template="classic">Classic</div>
      <div class="templateItem" data-template="modern">Modern</div>
      <div class="templateItem" data-template="luxe">Luxe</div>
    </div>

    <label>Telugu Headline</label>
    <input id="headlineTel" type="text" value="‡∞∞‡∞æ‡∞ò‡∞µ ‡∞ï‡∞®‡±ç‡∞∏‡∞≤‡±ç‡∞ü‡±Ü‡∞®‡±ç‡∞∏‡±Ä ‚Äî ‡∞π‡±ã‡∞Æ‡±ç ‡∞≤‡±ã‡∞®‡±ç‡∞∏‡±ç & ‡∞Æ‡∞æ‡∞∞‡±ç‡∞ü‡±ç‡∞ó‡±á‡∞ú‡±ç ‡∞≤‡±ã‡∞®‡±ç‡∞∏‡±ç">

    <label>Telugu Subheading</label>
    <input id="subTel" type="text" value="‡∞Æ‡±Ä ‡∞ï‡∞≤‡∞≤ ‡∞á‡∞≤‡±ç‡∞≤‡±Å ‡∞á‡∞™‡±ç‡∞™‡±Å‡∞°‡±Å ‡∞Æ‡±Ä ‡∞ö‡±á‡∞§‡±Å‡∞≤‡±ç‡∞≤‡±ã‡∞®‡±á!">

    <label>Bullets (comma-separated)</label>
    <input id="bullets" type="text" value="‚Çπ5 ‡∞≤‡∞ï‡±ç‡∞∑‡∞≤ ‡∞®‡±Å‡∞Ç‡∞°‡∞ø ‚Çπ1 ‡∞ï‡±ã‡∞ü‡∞ø ‡∞µ‡∞∞‡∞ï‡±Å ‡∞≤‡±ã‡∞®‡±ç, ‡∞§‡∞ï‡±ç‡∞ï‡±Å‡∞µ ‡∞µ‡∞°‡±ç‡∞°‡±Ä ‡∞∞‡±á‡∞ü‡±ç‡∞≤‡±Å & ‡∞µ‡±á‡∞ó‡∞µ‡∞Ç‡∞§‡∞Æ‡±à‡∞® ‡∞Æ‡∞Ç‡∞ú‡±Ç‡∞∞‡±Å, ‡∞°‡±ã‡∞∞‡±ç‚Äå‡∞∏‡±ç‡∞ü‡±Ü‡∞™‡±ç ‡∞°‡∞æ‡∞ï‡±ç‡∞Ø‡±Å‡∞Æ‡±Ü‡∞Ç‡∞ü‡±á‡∞∑‡∞®‡±ç">

    <div class="row">
      <div class="small">
        <label>Phone</label>
        <input id="phone" type="text" value="90148 33945">
      </div>
      <div class="small">
        <label>Website</label>
        <input id="site" type="text" value="www.raghavaconsultency.com">
      </div>
    </div>

    <label>Upload Photo (optional)</label>
    <input id="photoFile" type="file" accept="image/*">

    <label>Upload Logo (optional)</label>
    <input id="logoFile" type="file" accept="image/*">

    <div style="display:flex; gap:8px;">
      <button id="renderBtn" class="btn">Render</button>
      <button id="downloadBtn" class="btn secondary">Download PNG</button>
    </div>

    <div style="display:flex; gap:8px; margin-top:8px;">
      <button id="downloadPoster" class="btn" style="background:linear-gradient(90deg,#6f4bd7,#9b6cf2)">Download Poster (2000√ó3000)</button>
      <button id="downloadSet" class="btn" style="background:linear-gradient(90deg,#3dd6a5,#18b686)">Download All Sizes</button>
    </div>

    <div style="margin-top:8px; color:#9ec6e3; font-size:13px;">Tip: test with lengthy Telugu bullets to verify auto-adjustment.</div>
  </aside>

  <main class="previewWrap" aria-live="polite">
    <canvas id="adCanvas" width="1080" height="1920" role="img" aria-label="Ad preview"></canvas>
    <div class="meta">Preview (scaled). Click Render then Download. Enhanced Design!</div>
  </main>

<script>
/* Complete enhanced ad generator with premium design */

// DOM elements
const canvas = document.getElementById('adCanvas');
const ctx = canvas.getContext('2d', { alpha: false });
const renderBtn = document.getElementById('renderBtn');
const downloadBtn = document.getElementById('downloadBtn');
const downloadPoster = document.getElementById('downloadPoster');
const downloadSet = document.getElementById('downloadSet');

const headlineTelInput = document.getElementById('headlineTel');
const subTelInput = document.getElementById('subTel');
const bulletsInput = document.getElementById('bullets');
const phoneInput = document.getElementById('phone');
const siteInput = document.getElementById('site');
const photoFile = document.getElementById('photoFile');
const logoFile = document.getElementById('logoFile');
const templateItems = Array.from(document.querySelectorAll('.templateItem'));

let activeTemplate = 'classic';
templateItems.forEach(it => it.addEventListener('click', ()=> {
  templateItems.forEach(i=>i.classList.remove('active'));
  it.classList.add('active');
  activeTemplate = it.dataset.template;
}));

// uploaded images
let uploadedPhoto = null;
let uploadedLogo = null;
photoFile.addEventListener('change', e => {
  const f = e.target.files[0];
  if(!f) return;
  const url = URL.createObjectURL(f);
  loadImage(url).then(img => { uploadedPhoto = img; URL.revokeObjectURL(url); }).catch(()=>{ uploadedPhoto=null; });
});
logoFile.addEventListener('change', e => {
  const f = e.target.files[0];
  if(!f) return;
  const url = URL.createObjectURL(f);
  loadImage(url).then(img => { uploadedLogo = img; URL.revokeObjectURL(url); }).catch(()=>{ uploadedLogo=null; });
});

// helper: load HTMLImageElement
function loadImage(src){
  return new Promise((resolve,reject)=>{
    const img = new Image();
    img.crossOrigin = "anonymous";
    img.onload = ()=> resolve(img);
    img.onerror = reject;
    img.src = src;
  });
}

// rounding helper
function roundRectPath(ctx,x,y,w,h,r){
  ctx.beginPath();
  ctx.moveTo(x+r,y);
  ctx.arcTo(x+w,y,x+w,y+h,r);
  ctx.arcTo(x+w,y+h,x,y+h,r);
  ctx.arcTo(x,y+h,x,y,r);
  ctx.arcTo(x,y,x+w,y,r);
  ctx.closePath();
}

// simple house icon drawer
function drawHouseIcon(ctx,x,y,size,fill){
  ctx.save();
  ctx.translate(x,y);
  ctx.beginPath();
  ctx.moveTo(0,-size*0.35);
  ctx.lineTo(-size*0.45,0);
  ctx.lineTo(-size*0.45,size*0.35);
  ctx.lineTo(size*0.45,size*0.35);
  ctx.lineTo(size*0.45,0);
  ctx.closePath();
  ctx.fillStyle = fill;
  ctx.fill();
  ctx.restore();
}

// measure wrapped lines (returns array)
function measureWrappedLines(ctx, text, maxWidth){
  const words = text.split(' ');
  let line = '';
  const lines = [];
  for(let n=0;n<words.length;n++){
    const testLine = line + words[n] + ' ';
    const metrics = ctx.measureText(testLine);
    if(metrics.width > maxWidth && n > 0){
      lines.push(line.trim());
      line = words[n] + ' ';
    } else {
      line = testLine;
    }
  }
  if(line.trim().length) lines.push(line.trim());
  return lines;
}

// draw array of lines at x,y with lineHeight. align: 'left'|'center'
function drawWrappedText(ctx, lines, x, y, lineHeight, align='left'){
  ctx.textAlign = align;
  for(let i=0;i<lines.length;i++){
    ctx.fillText(lines[i], x, y + (i * lineHeight));
  }
  return lines.length * lineHeight;
}

// main draw function (dynamic)
async function draw(data, width=1080, height=1920){
  await document.fonts.ready;
  canvas.width = width;
  canvas.height = height;

  // background per template - ENHANCED
  if(activeTemplate === 'classic'){
    // Rich gradient with depth
    const g = ctx.createLinearGradient(0,0,0,height);
    g.addColorStop(0,'#0a1929'); g.addColorStop(0.3,'#0d2d4a'); 
    g.addColorStop(0.7,'#081f3b'); g.addColorStop(1,'#030d1a');
    ctx.fillStyle = g; ctx.fillRect(0,0,width,height);
    
    // Radial accent glow
    const accent = ctx.createRadialGradient(width*0.5, height*0.25, 0, width*0.5, height*0.25, width*0.8);
    accent.addColorStop(0,'rgba(245,180,66,0.15)');
    accent.addColorStop(0.4,'rgba(245,180,66,0.04)');
    accent.addColorStop(1,'rgba(0,0,0,0)');
    ctx.fillStyle = accent; ctx.fillRect(0,0,width,height);
  } else if(activeTemplate === 'modern'){
    // Bold modern gradient
    const g = ctx.createLinearGradient(width*0.2,0,width*0.8,height);
    g.addColorStop(0,'#0a2540'); g.addColorStop(0.5,'#0e3d5f'); g.addColorStop(1,'#071825');
    ctx.fillStyle = g; ctx.fillRect(0,0,width,height);
    
    // Corner accents
    const corner1 = ctx.createRadialGradient(0, 0, 0, 0, 0, width*0.6);
    corner1.addColorStop(0,'rgba(34,150,214,0.12)');
    corner1.addColorStop(1,'rgba(0,0,0,0)');
    ctx.fillStyle = corner1; ctx.fillRect(0,0,width,height);
  } else {
    // Luxe premium gradient
    const g = ctx.createLinearGradient(0,0,0,height);
    g.addColorStop(0,'#0b1520'); g.addColorStop(0.4,'#162843'); 
    g.addColorStop(0.75,'#0d1f38'); g.addColorStop(1,'#08111d');
    ctx.fillStyle = g; ctx.fillRect(0,0,width,height);
    
    // Premium gold vignette
    const vign = ctx.createRadialGradient(width*0.5, height*0.3, 100, width*0.5, height*0.3, Math.max(width,height)*0.7);
    vign.addColorStop(0,'rgba(245,180,66,0.18)'); 
    vign.addColorStop(0.5,'rgba(245,180,66,0.06)');
    vign.addColorStop(1,'rgba(0,0,0,0.1)');
    ctx.fillStyle = vign; ctx.fillRect(0,0,width,height);
  }

  // Enhanced atmospheric glow with multiple layers
  const glow1 = ctx.createRadialGradient(width/2, height*0.38, 50, width/2, height*0.38, width*0.7);
  glow1.addColorStop(0,'rgba(245,180,66,0.25)');
  glow1.addColorStop(0.3,'rgba(245,180,66,0.08)');
  glow1.addColorStop(0.6,'rgba(34,150,214,0.04)');
  glow1.addColorStop(1,'rgba(0,0,0,0)');
  ctx.fillStyle = glow1; ctx.fillRect(0,0,width,height);

  // Sophisticated skyline with varied buildings
  ctx.save();
  ctx.globalAlpha = 0.08; 
  const buildingData = [
    {x:0, w:110, h:180}, {x:120, w:90, h:240}, {x:220, w:130, h:160},
    {x:360, w:95, h:280}, {x:465, w:115, h:200}, {x:590, w:100, h:320},
    {x:700, w:130, h:190}, {x:840, w:90, h:260}, {x:940, w:110, h:150}
  ];
  buildingData.forEach(b => {
    const by = height*0.56 - b.h;
    const grad = ctx.createLinearGradient(b.x, by, b.x, by + b.h);
    grad.addColorStop(0,'rgba(0,0,0,0.8)');
    grad.addColorStop(1,'rgba(0,0,0,0.3)');
    ctx.fillStyle = grad;
    ctx.fillRect(b.x, by, b.w, b.h);
    // Windows
    for(let wy = by + 30; wy < by + b.h - 20; wy += 45){
      for(let wx = b.x + 20; wx < b.x + b.w - 20; wx += 35){
        ctx.fillStyle = Math.random() > 0.4 ? 'rgba(255,220,162,0.6)' : 'rgba(255,220,162,0.15)';
        ctx.fillRect(wx, wy, 18, 28);
      }
    }
  });
  ctx.restore();

  // Premium house illustration with depth
  const houseW = Math.round(width*0.52);
  const houseH = Math.round(height*0.24);
  const houseX = Math.round(width*0.05);
  const houseY = Math.round(height*0.47);
  
  // House shadow
  ctx.save();
  ctx.globalAlpha = 0.3;
  roundRectPath(ctx, houseX + 8, houseY + 8, houseW, houseH, 28);
  ctx.fillStyle = 'rgba(0,0,0,0.5)'; ctx.fill();
  ctx.restore();
  
  // House body with gradient
  roundRectPath(ctx, houseX, houseY, houseW, houseH, 28);
  const houseGrad = ctx.createLinearGradient(houseX, houseY, houseX, houseY + houseH);
  houseGrad.addColorStop(0,'rgba(255,255,255,0.08)');
  houseGrad.addColorStop(1,'rgba(255,255,255,0.02)');
  ctx.fillStyle = houseGrad; ctx.fill();
  
  // House border glow
  ctx.strokeStyle = 'rgba(245,180,66,0.25)';
  ctx.lineWidth = 2;
  ctx.stroke();

  // Windows with glow effect
  const windowData = [
    {x: houseX+50, y: houseY+50, w: 155, h: 100},
    {x: houseX+230, y: houseY+50, w: 135, h: 100},
    {x: houseX+390, y: houseY+50, w: 110, h: 100}
  ];
  windowData.forEach(win => {
    // Window glow
    ctx.save();
    ctx.shadowColor = 'rgba(255,220,162,0.6)';
    ctx.shadowBlur = 25;
    ctx.fillStyle = '#ffdca2'; 
    roundRectPath(ctx, win.x, win.y, win.w, win.h, 8);
    ctx.fill();
    ctx.restore();
    
    // Window frame
    ctx.strokeStyle = 'rgba(0,0,0,0.2)';
    ctx.lineWidth = 3;
    roundRectPath(ctx, win.x, win.y, win.w, win.h, 8);
    ctx.stroke();
    
    // Window panes
    ctx.strokeStyle = 'rgba(0,0,0,0.15)';
    ctx.lineWidth = 2;
    ctx.beginPath();
    ctx.moveTo(win.x + win.w/2, win.y);
    ctx.lineTo(win.x + win.w/2, win.y + win.h);
    ctx.moveTo(win.x, win.y + win.h/2);
    ctx.lineTo(win.x + win.w, win.y + win.h/2);
    ctx.stroke();
  });
  
  // Roof with enhanced styling
  ctx.save();
  ctx.beginPath(); 
  ctx.moveTo(houseX-25, houseY+15); 
  ctx.lineTo(houseX+houseW/2, houseY-130); 
  ctx.lineTo(houseX+houseW+25, houseY+15); 
  ctx.closePath();
  
  const roofGrad = ctx.createLinearGradient(houseX, houseY-130, houseX, houseY+15);
  roofGrad.addColorStop(0,'rgba(0,0,0,0.25)');
  roofGrad.addColorStop(1,'rgba(0,0,0,0.1)');
  ctx.fillStyle = roofGrad;
  ctx.fill();
  
  ctx.strokeStyle='rgba(245,180,66,0.3)'; 
  ctx.lineWidth=5; 
  ctx.stroke();
  ctx.restore();

  // draw logo or text top-left with modern styling
  if(uploadedLogo){
    const lW = Math.round(width*0.2), lH = Math.round(width*0.065), lx = Math.round(width*0.05), ly = Math.round(height*0.055);
    
    // Logo background with depth
    ctx.save();
    ctx.shadowColor = 'rgba(0,0,0,0.4)';
    ctx.shadowBlur = 20;
    roundRectPath(ctx, lx-10, ly-10, lW+20, lH+20, 14); 
    const logoBg = ctx.createLinearGradient(lx, ly, lx, ly + lH);
    logoBg.addColorStop(0,'rgba(255,255,255,0.1)');
    logoBg.addColorStop(1,'rgba(255,255,255,0.03)');
    ctx.fillStyle = logoBg; 
    ctx.fill();
    ctx.restore();
    
    const img = uploadedLogo;
    const ratio = Math.min(lW/img.width, lH/img.height);
    const drawW = img.width * ratio; const drawH = img.height * ratio;
    const drawX = lx + (lW - drawW)/2; const drawY = ly + (lH - drawH)/2;
    ctx.drawImage(img, drawX, drawY, drawW, drawH);
  } else {
    ctx.save();
    ctx.font = '800 36px Poppins, sans-serif'; 
    ctx.fillStyle = '#ffdca2';
    ctx.shadowColor = 'rgba(245,180,66,0.5)';
    ctx.shadowBlur = 15;
    ctx.textAlign = 'left'; 
    ctx.fillText('RaghavaConsultency', width*0.055, height*0.09);
    ctx.restore();
  }

  // headline (Telugu) with enhanced styling
  ctx.save();
  ctx.font = `900 ${Math.round(width*0.058)}px "Noto Sans Telugu", Poppins, sans-serif`;
  ctx.fillStyle = '#ffffff';
  ctx.shadowColor = 'rgba(245,180,66,0.4)';
  ctx.shadowBlur = 20;
  ctx.textAlign = 'center';
  wrapAndDraw(ctx, data.headlineTel, width/2, height*0.135, width - 100, Math.round(width*0.072));
  ctx.restore();

  // subheading with accent
  ctx.save();
  ctx.font = `600 ${Math.round(width*0.037)}px "Noto Sans Telugu", Poppins, sans-serif`;
  ctx.fillStyle = 'rgba(255,255,255,0.95)';
  ctx.shadowColor = 'rgba(0,0,0,0.3)';
  ctx.shadowBlur = 10;
  wrapAndDraw(ctx, data.subTel, width/2, height*0.2, width - 140, Math.round(width*0.046));
  ctx.restore();

  // BULLETS & PORTRAIT (DYNAMIC)
  // constants
  const bullets = data.bullets.split(',').map(s=>s.trim()).filter(Boolean).slice(0,8);
  const bulletsFontSize = Math.round(width*0.034);
  ctx.font = `500 ${bulletsFontSize}px "Noto Sans Telugu", Poppins, sans-serif`;
  const bulletsMaxWidth = Math.round(width * 0.36); // available width for bullet text
  const bulletsX = Math.round(width * 0.58);
  let bulletsY = Math.round(height * 0.52);
  const bulletLineHeight = Math.round(width * 0.048);

  // measure each bullet (lines & height)
  const measured = bullets.map(b => {
    const lines = measureWrappedLines(ctx, b, bulletsMaxWidth);
    return { text: b, lines, height: lines.length * bulletLineHeight };
  });

  // total bullets height with small spacing
  const bulletsTotalHeight = measured.reduce((acc,m)=> acc + m.height + Math.round(width*0.015), 0);

  // portrait candidate
  const portraitSize = Math.round(width*0.22);
  let portraitX = Math.round(width * 0.74);
  let portraitY = Math.round(height * 0.50);

  // compute vertical ranges
  const bulletsTop = bulletsY;
  const bulletsBottom = bulletsY + bulletsTotalHeight;
  const portraitTop = portraitY - portraitSize/2;
  const portraitBottom = portraitY + portraitSize/2;

  // if vertical overlap (and horizontal proximity) -> move portrait below bullets
  if (!( (bulletsBottom < portraitTop - 20) || (bulletsTop > portraitBottom + 20) )){
    portraitY = bulletsBottom + portraitSize/2 + Math.round(width*0.04);
  }

  // draw bullets now with modern icons
  ctx.fillStyle = 'rgba(255,255,255,0.96)';
  let currentY = bulletsY;
  measured.forEach((m, idx) => {
    // Modern bullet circle with gradient
    ctx.save();
    const bulletGrad = ctx.createRadialGradient(bulletsX - 70, currentY + 6, 0, bulletsX - 70, currentY + 6, 28);
    bulletGrad.addColorStop(0,'#ffdca2');
    bulletGrad.addColorStop(1,'#f5b041');
    ctx.fillStyle = bulletGrad;
    
    ctx.shadowColor = 'rgba(245,180,66,0.5)';
    ctx.shadowBlur = 15;
    ctx.beginPath();
    ctx.arc(bulletsX - 70, currentY + 6, 26, 0, Math.PI*2);
    ctx.fill();
    ctx.restore();
    
    // Inner circle for depth
    ctx.beginPath();
    ctx.arc(bulletsX - 70, currentY + 6, 20, 0, Math.PI*2);
    ctx.fillStyle = 'rgba(11, 39, 64, 0.3)';
    ctx.fill();
    
    // Enhanced house icon
    ctx.save(); 
    ctx.fillStyle = '#0b2740'; 
    ctx.shadowColor = 'rgba(0,0,0,0.3)';
    ctx.shadowBlur = 4;
    drawHouseIcon(ctx, bulletsX - 77, currentY - 6, 28, '#0b2740'); 
    ctx.restore();
    
    // draw wrapped lines with shadow
    ctx.save();
    ctx.shadowColor = 'rgba(0,0,0,0.3)';
    ctx.shadowBlur = 8;
    ctx.fillStyle = '#fff';
    drawWrappedText(ctx, m.lines, bulletsX - 20, currentY + 6, bulletLineHeight, 'left');
    ctx.restore();
    
    currentY += m.height + Math.round(width*0.015);
  });

  // Draw portrait with premium styling
  if(uploadedPhoto){
    const px = portraitX, py = portraitY, pSize = portraitSize;
    ctx.save();
    
    // Outer glow ring
    ctx.beginPath();
    ctx.arc(px, py - 20, pSize/2 + 15, 0, Math.PI*2);
    const glowGrad = ctx.createRadialGradient(px, py - 20, pSize/2, px, py - 20, pSize/2 + 15);
    glowGrad.addColorStop(0,'rgba(245,180,66,0.6)');
    glowGrad.addColorStop(1,'rgba(245,180,66,0)');
    ctx.fillStyle = glowGrad;
    ctx.fill();
    
    // Border ring
    ctx.beginPath();
    ctx.arc(px, py - 20, pSize/2 + 6, 0, Math.PI*2);
    ctx.strokeStyle = 'rgba(245,180,66,0.8)';
    ctx.lineWidth = 8;
    ctx.stroke();
    
    // Inner border
    ctx.beginPath();
    ctx.arc(px, py - 20, pSize/2 + 3, 0, Math.PI*2);
    ctx.strokeStyle = 'rgba(255,255,255,0.2)';
    ctx.lineWidth = 2;
    ctx.stroke();
    
    // Shadow
    ctx.shadowColor = 'rgba(0,0,0,0.4)';
    ctx.shadowBlur = 30;
    ctx.shadowOffsetY = 10;
    
    // clip circle and draw photo
    ctx.beginPath(); ctx.arc(px, py - 20, pSize/2, 0, Math.PI*2); ctx.closePath(); ctx.clip();
    const img = uploadedPhoto;
    let sx=0, sy=0, sw=img.width, sh=img.height;
    const ratio = img.width / img.height;
    if(ratio > 1){ sw = img.height; sx = Math.round((img.width - sw)/2); } else { sh = img.width; sy = Math.round((img.height - sh)/2); }
    ctx.drawImage(img, sx, sy, sw, sh, px - pSize/2, py - 20 - pSize/2, pSize, pSize);
    ctx.restore();
  } else {
    // Enhanced placeholder
    const px = portraitX, py = portraitY, pSize = portraitSize;
    ctx.save();
    
    // Outer glow
    ctx.beginPath();
    ctx.arc(px, py - 20, pSize/2 + 12, 0, Math.PI*2);
    const placeholderGlow = ctx.createRadialGradient(px, py - 20, pSize/2, px, py - 20, pSize/2 + 12);
    placeholderGlow.addColorStop(0,'rgba(245,180,66,0.3)');
    placeholderGlow.addColorStop(1,'rgba(245,180,66,0)');
    ctx.fillStyle = placeholderGlow;
    ctx.fill();
    
    // Main circle
    ctx.beginPath(); 
    ctx.arc(px, py - 20, pSize/2, 0, Math.PI*2); 
    const circleGrad = ctx.createLinearGradient(px, py - 20 - pSize/2, px, py - 20 + pSize/2);
    circleGrad.addColorStop(0,'rgba(255,255,255,0.12)');
    circleGrad.addColorStop(1,'rgba(255,255,255,0.04)');
    ctx.fillStyle = circleGrad;
    ctx.fill();
    
    // Border
    ctx.strokeStyle = 'rgba(245,180,66,0.6)';
    ctx.lineWidth = 5;
    ctx.stroke();
    
    // Text with glow
    ctx.shadowColor = 'rgba(245,180,66,0.6)';
    ctx.shadowBlur = 15;
    ctx.font = `800 ${Math.round(pSize*0.32)}px Poppins, sans-serif`; 
    ctx.fillStyle = '#ffdca2'; 
    ctx.textAlign='center'; 
    ctx.textBaseline='middle';
    ctx.fillText('HP', px, py - 20);
    ctx.restore();
  }

  // PREMIUM CONTACT BLOCK with modern design
  const cH = Math.round(height*0.16);
  const cW = Math.round(width*0.88);
  const cX = Math.round((width - cW)/2);
  const cY = Math.round(height*0.73);
  
  ctx.save();
  
  // Shadow layer
  ctx.shadowColor = 'rgba(0,0,0,0.5)';
  ctx.shadowBlur = 30;
  ctx.shadowOffsetY = 10;
  
  roundRectPath(ctx, cX, cY, cW, cH, 24); 
  
  // Gradient background
  const contactGrad = ctx.createLinearGradient(cX, cY, cX, cY + cH);
  contactGrad.addColorStop(0,'rgba(20,40,60,0.85)');
  contactGrad.addColorStop(1,'rgba(10,25,45,0.92)');
  ctx.fillStyle = contactGrad;
  ctx.fill();
  
  // Border glow
  ctx.strokeStyle = 'rgba(245,180,66,0.4)';
  ctx.lineWidth = 3;
  ctx.stroke();
  ctx.restore();
  
  // Accent line
  ctx.save();
  const accentGrad = ctx.createLinearGradient(cX + 40, cY + 20, cX + cW - 40, cY + 20);
  accentGrad.addColorStop(0,'rgba(245,180,66,0)');
  accentGrad.addColorStop(0.5,'rgba(245,180,66,0.6)');
  accentGrad.addColorStop(1,'rgba(245,180,66,0)');
  ctx.strokeStyle = accentGrad;
  ctx.lineWidth = 2;
  ctx.beginPath();
  ctx.moveTo(cX + 40, cY + 20);
  ctx.lineTo(cX + cW - 40, cY + 20);
  ctx.stroke();
  ctx.restore();

  // Phone number with enhanced styling
  ctx.save();
  ctx.font = `900 ${Math.round(width*0.06)}px Poppins, sans-serif`; 
  ctx.fillStyle='#ffffff'; 
  ctx.shadowColor = 'rgba(245,180,66,0.6)';
  ctx.shadowBlur = 20;
  ctx.textAlign='center';
  ctx.fillText('üìû ' + data.phone, width/2, cY + (cH*0.42));
  ctx.restore();

  // Website with icon
  ctx.save();
  ctx.font = `600 ${Math.round(width*0.034)}px Poppins, sans-serif`; 
  ctx.fillStyle = 'rgba(255,255,255,0.88)';
  ctx.shadowColor = 'rgba(0,0,0,0.4)';
  ctx.shadowBlur = 8;
  ctx.fillText('üåê ' + data.site, width/2, cY + (cH*0.74));
  ctx.restore();

  // Brand name with premium styling
  ctx.save();
  ctx.font = `900 ${Math.round(width*0.053)}px Poppins, sans-serif`; 
  ctx.fillStyle='#ffdca2';
  ctx.shadowColor = 'rgba(245,180,66,0.7)';
  ctx.shadowBlur = 25;
  ctx.textAlign='center';
  ctx.fillText('RAGHAVA Consultency', width/2, height*0.92);
  ctx.restore();

  // Tagline with accent
  ctx.save();
  ctx.font = `600 ${Math.round(width*0.032)}px Poppins, sans-serif`; 
  ctx.fillStyle='rgba(255,255,255,0.92)';
  ctx.shadowColor = 'rgba(0,0,0,0.5)';
  ctx.shadowBlur = 10;
  ctx.fillText('‚ú® Transforming Dreams into Homes ‚ú®', width/2, height*0.958);
  ctx.restore();

  // Footer with subtle styling
  ctx.save();
  ctx.font = `400 ${Math.round(width*0.022)}px Poppins, sans-serif`; 
  ctx.fillStyle='rgba(255,255,255,0.4)';
  ctx.fillText('Associated with major Banks & NBFCs', width/2, height*0.986);
  ctx.restore();
}

// small helper: wrap and draw (used for headline/sub)
function wrapAndDraw(ctx, text, x, y, maxWidth, lineHeight){
  const font = ctx.font;
  const lines = measureWrappedLines(ctx, text, maxWidth);
  for(let i=0;i<lines.length;i++){
    ctx.fillText(lines[i], x, y + (i * lineHeight));
  }
  ctx.font = font;
}

// render driver
async function renderAd(width=1080, height=1920){
  const data = {
    headlineTel: headlineTelInput.value.trim() || '‡∞∞‡∞æ‡∞ò‡∞µ ‡∞ï‡∞®‡±ç‡∞∏‡∞≤‡±ç‡∞ü‡±Ü‡∞®‡±ç‡∞∏‡±Ä ‚Äî ‡∞π‡±ã‡∞Æ‡±ç ‡∞≤‡±ã‡∞®‡±ç‡∞∏‡±ç',
    subTel: subTelInput.value.trim() || '‡∞Æ‡±Ä ‡∞ï‡∞≤‡∞≤ ‡∞á‡∞≤‡±ç‡∞≤‡±Å ‡∞á‡∞™‡±ç‡∞™‡±Å‡∞°‡±Å ‡∞Æ‡±Ä ‡∞ö‡±á‡∞§‡±Å‡∞≤‡±ç‡∞≤‡±ã‡∞®‡±á!',
    bullets: bulletsInput.value.trim() || '‚Çπ5 ‡∞≤‡∞ï‡±ç‡∞∑‡∞≤ ‡∞®‡±Å‡∞Ç‡∞°‡∞ø ‚Çπ1 ‡∞ï‡±ã‡∞ü‡∞ø ‡∞µ‡∞∞‡∞ï‡±Å ‡∞≤‡±ã‡∞®‡±ç, ‡∞§‡∞ï‡±ç‡∞ï‡±Å‡∞µ ‡∞µ‡∞°‡±ç‡∞°‡±Ä ‡∞∞‡±á‡∞ü‡±ç‡∞≤‡±Å, ‡∞°‡±ã‡∞∞‡±ç‚Äå‡∞∏‡±ç‡∞ü‡±Ü‡∞™‡±ç ‡∞°‡∞æ‡∞ï‡±ç‡∞Ø‡±Å‡∞Æ‡±Ü‡∞Ç‡∞ü‡±á‡∞∑‡∞®‡±ç',
    phone: phoneInput.value.trim() || '90148 33945',
    site: siteInput.value.trim() || 'www.raghavaconsultency.com'
  };
  await draw(data, width, height);
}

// download at size
function downloadCanvas(filename, width=1080, height=1920){
  return new Promise(async (resolve)=>{
    await renderAd(width, height);
    const dataURL = canvas.toDataURL('image/png');
    const link = document.createElement('a');
    link.href = dataURL;
    link.download = filename;
    document.body.appendChild(link); link.click(); link.remove();
    resolve();
  });
}

// events
renderBtn.addEventListener('click', ()=> renderAd());
downloadBtn.addEventListener('click', async ()=> { await downloadCanvas('raghava_ad_1080x1920.png', 1080, 1920); });
downloadPoster.addEventListener('click', async ()=> { await downloadCanvas('raghava_poster_2000x3000.png', 2000, 3000); });
downloadSet.addEventListener('click', async ()=>{
  await downloadCanvas('raghava_ad_1080x1920.png', 1080, 1920);
  await new Promise(r=>setTimeout(r,200));
  await downloadCanvas('raghava_poster_2000x3000.png', 2000, 3000);
});

// initial render
window.addEventListener('load', ()=> { setTimeout(()=> renderAd(), 240); });
</script>

</body>
</html>
